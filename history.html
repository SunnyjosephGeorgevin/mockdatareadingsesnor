<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Previous Mockdata Records</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(135deg,#004d40,#009688,#a5d6a7);
      color:white; font-family:'Poppins',sans-serif; text-align:center;
      min-height:100vh; padding:20px;
    }
    h1{margin-top:20px;font-weight:600;}
    table{
      width:95%;margin:30px auto;background:rgba(255,255,255,0.15);
      border-radius:10px;overflow:hidden;border-collapse:separate;border-spacing:0;
    }
    th,td{
      padding:12px;border-bottom:1px solid rgba(255,255,255,0.2);
      cursor:pointer;
    }
    tr:nth-child(even){background:rgba(255,255,255,0.05);}
    tr:hover{background:rgba(255,255,255,0.2);}
    a{color:#fff;text-decoration:none;}
    a:hover{text-decoration:underline;}
  </style>
</head>
<body>
  <h1>üìú Previous Sensor Reading Records</h1>
  <p><a href="index.html">‚Üê Back to Live Dashboard</a></p>

  <div class="table-responsive">
    <table class="table table-hover text-white">
      <thead>
        <tr>
          <th onclick="sortTable(0)">Date</th>
          <th onclick="sortTable(1)">Time</th>
          <th onclick="sortTable(2)">CO‚ÇÇ (ppm)</th>
          <th onclick="sortTable(3)">Temp (¬∞C)</th>
          <th onclick="sortTable(4)">Humidity (%)</th>
          <th onclick="sortTable(5)">Pressure (hPa)</th>
          <th onclick="sortTable(6)">Light (lux)</th>
        </tr>
      </thead>
      <tbody id="table-body"></tbody>
    </table>
  </div>

  <script>
    const tbody = document.getElementById("table-body");
    let historyData = JSON.parse(localStorage.getItem("ecochainHistory") || "[]").reverse();

    function renderTable(data) {
      tbody.innerHTML = '';
      if (data.length === 0) {
        tbody.innerHTML = `<tr><td colspan="7">No records yet ‚Äî open the Live Dashboard first.</td></tr>`;
        return;
      }

      data.forEach(row => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${row.date}</td><td>${row.time}</td>
          <td>${row.co2.toFixed(0)} ppm</td>
          <td>${row.temperature.toFixed(2)} ¬∞C</td>
          <td>${row.humidity.toFixed(2)} %</td>
          <td>${row.pressure.toFixed(2)} hPa</td>
          <td>${row.light.toFixed(2)} lux</td>`;
        tbody.appendChild(tr);
      });
    }

    let sortDirection = 1;

    function sortTable(n) {
      sortDirection *= -1;
      historyData.sort((a,b)=>{
        let aVal,bVal;
        switch(n){
          case 0:aVal=a.date;bVal=b.date;break;
          case 1:aVal=a.time;bVal=b.time;break;
          case 2:aVal=a.co2;bVal=b.co2;break;
          case 3:aVal=a.temperature;bVal=b.temperature;break;
          case 4:aVal=a.humidity;bVal=b.humidity;break;
          case 5:aVal=a.pressure;bVal=b.pressure;break;
          case 6:aVal=a.light;bVal=b.light;break;
        }
        if(typeof aVal==="number"){return (aVal-bVal)*sortDirection;}
        if(aVal<bVal)return -1*sortDirection;
        if(aVal>bVal)return 1*sortDirection;
        return 0;
      });
      renderTable(historyData);
    }

    renderTable(historyData);
  </script>
</body>
</html>
